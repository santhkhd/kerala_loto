<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket Scanner - Kerala Lottery</title>
    <style>
        :root {
            --primary: #2563eb;
            --accent: #7ecbff;
            --bg: #e9edf5;
            --glass: rgba(255,255,255,0.7);
            --card-bg: rgba(35,41,70,0.92);
            --card-fg: #fff;
            --nav-bg: #fff;
            --nav-active: #2563eb;
            --nav-inactive: #6b7280;
            --nav-shadow: 0 -2px 12px rgba(30,60,120,0.08);
            --border-radius: 18px;
            --shadow: 0 8px 32px rgba(30,60,120,0.13);
        }
        html, body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--bg);
            color: #232946;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .header {
            background: linear-gradient(90deg, #1a2980 0%, #2575fc 100%);
            color: #fff;
            padding: 18px 0 10px 0;
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
            letter-spacing: 1px;
            position: relative;
            box-shadow: 0 2px 8px rgba(30,60,120,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5em;
        }
        .header .back-btn {
            position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
            background: none; border: none; color: #fff; font-size: 1.3em;
            cursor: pointer; display: block;
        }
        .header .lang-icon-btn {
            position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
            background: none; border: none; font-size: 1.5em; color: #fff;
            cursor: pointer; padding: 2px 8px 2px 2px; border-radius: 6px;
            transition: background 0.2s;
        }
        .lang-popup {
            display: none; position: fixed; top: 56px; right: 12px; z-index: 200;
            background: #fff; border-radius: 16px; box-shadow: 0 4px 24px rgba(30,60,120,0.13);
            padding: 18px 24px 12px 24px; min-width: 180px; animation: fadeIn 0.2s;
        }
        .lang-popup.active { display: block; }
        .lang-popup-title { font-weight: 700; margin-bottom: 10px; color: var(--primary); font-size: 1.1em; }
        .lang-popup-btn { display: block; width: 100%; background: none; border: none; color: var(--nav-inactive); font-size: 1em; font-weight: 600; text-align: left; padding: 8px 0; border-radius: 6px; cursor: pointer; transition: background 0.2s, color 0.2s; }
        .lang-popup-btn.active { color: var(--nav-active); background: #e0e7ff; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .main-content {
            max-width: 500px; margin: 0 auto; padding: 32px 12px 90px 12px;
            display: flex; flex-direction: column; align-items: center;
        }
        .glass-card {
            background: var(--glass);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 32px 24px 24px 24px;
            margin-bottom: 32px;
            width: 100%;
            display: flex; flex-direction: column; align-items: center;
            backdrop-filter: blur(8px);
            border: 1.5px solid #e0e7ff;
            transition: box-shadow 0.2s;
        }
        .glass-card h2 {
            margin: 0 0 18px 0;
            font-size: 1.3em;
            color: var(--primary);
            text-align: center;
            letter-spacing: 1px;
        }
        .btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        .btn.secondary {
            background: #6b7280;
        }
        .btn.secondary:hover {
            background: #4b5563;
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.4);
        }
        .btn.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .btn.success:hover {
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        .upload-area {
            border: 3px dashed #7ecbff;
            border-radius: 16px;
            padding: 48px 20px;
            text-align: center;
            background: linear-gradient(135deg, #e9edf5 0%, #f3f6fb 100%);
            transition: all 0.3s;
            cursor: pointer;
            margin-bottom: 24px;
            box-shadow: 0 4px 24px #2563eb11;
        }
        .upload-area:hover {
            border-color: #2563eb;
            background: #e0e7ff;
        }
        .upload-area.dragover {
            border-color: #10b981;
            background: #ecfdf5;
        }
        .upload-icon {
            font-size: 3em;
            color: #3b82f6;
            margin-bottom: 15px;
        }
        .upload-text {
            font-size: 1.2em;
            color: #374151;
            margin-bottom: 10px;
        }
        .upload-subtext {
            color: #6b7280;
            font-size: 0.9em;
        }
        .camera-section {
            text-align: center;
            margin: 20px 0;
            background: rgba(255,255,255,0.7);
            border-radius: 16px;
            box-shadow: 0 4px 24px #2563eb11;
            padding: 18px 0 10px 0;
        }
        #video {
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 4px 24px #2563eb22;
        }
        .scan-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border: 3px solid #7ecbff;
            border-radius: 16px;
            pointer-events: none;
            box-shadow: 0 0 24px 4px #7ecbff55;
            animation: scanPulse 1.5s infinite alternate;
        }
        @keyframes scanPulse {
            0% { box-shadow: 0 0 24px 4px #7ecbff55; border-color: #7ecbff; }
            100% { box-shadow: 0 0 36px 8px #2563eb99; border-color: #2563eb; }
        }
        .scan-result {
            margin-top: 20px;
            padding: 28px 20px 22px 20px;
            border-radius: 18px;
            font-weight: bold;
            font-size: 1.18em;
            box-shadow: 0 8px 32px #2563eb22;
            background: rgba(255,255,255,0.85);
            color: #232946;
            position: relative;
            animation: popResult 0.6s cubic-bezier(.23,1.5,.32,1);
            text-align: center;
        }
        @keyframes popResult {
            0% { transform: scale(0.7); opacity: 0.2; }
            60% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .scan-result.success {
            background: linear-gradient(135deg, #10b981 0%, #7ecbff 100%);
            color: #fff;
            box-shadow: 0 8px 32px #10b98133;
        }
        .scan-result.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: #fff;
            box-shadow: 0 8px 32px #ef444433;
        }
        .scan-result.info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: #fff;
            box-shadow: 0 8px 32px #3b82f633;
        }
        .scan-result .result-icon {
            font-size: 2.5em;
            display: block;
            margin-bottom: 10px;
            text-shadow: 0 2px 8px #2563eb44;
        }
        .scan-result .result-text {
            font-size: 1.18em;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }
        .scan-result .btn {
            margin-top: 16px;
            font-size: 1.08em;
            padding: 12px 28px;
            border-radius: 14px;
            box-shadow: 0 2px 8px #2563eb22;
        }
        .manual-input {
            margin-top: 30px;
            padding: 28px 18px 22px 18px;
            background: linear-gradient(135deg, #f3f6fb 0%, #e9edf5 100%);
            border-radius: 16px;
            border: 2px solid #e0e7ff;
            box-shadow: 0 4px 24px #2563eb11;
        }
        .manual-input h3 {
            color: #2563eb;
            font-size: 1.18em;
            font-weight: 700;
        }
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .input-group input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1em;
            min-width: 200px;
        }
        .input-group input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        .ticket-preview {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .ticket-preview.show {
            display: block;
        }
        .ticket-header {
            text-align: center;
            border-bottom: 2px solid #e1e5e9;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .ticket-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        .detail-label {
            font-weight: 600;
            color: #374151;
        }
        .detail-value {
            color: #3b82f6;
            font-weight: bold;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .example-tickets {
            margin-top: 30px;
        }
        .example-ticket {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.2s;
        }
        .example-ticket:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }
        .example-ticket h4 {
            margin: 0 0 10px 0;
            color: #1a2980;
        }
        .example-ticket p {
            margin: 5px 0;
            color: #6b7280;
        }
        @media (max-width: 600px) {
            .container {
                padding: 20px 15px;
            }
            .scanner-section {
                padding: 20px;
            }
            .upload-area {
                padding: 28px 6px;
            }
            .input-group {
                flex-direction: column;
            }
            .input-group input {
                width: 100%;
            }
            #video-container { max-width: 99vw; }
            .scan-result { font-size: 1em; padding: 18px 6px 14px 6px; }
            .manual-input { padding: 16px 4px 12px 4px; }
        }
        .bottom-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100vw;
            background: #181f36;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 0 4px 0;
            box-shadow: 0 -2px 12px rgba(0,0,0,0.13);
            z-index: 200;
        }
        .icon-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #7ecbff;
            font-size: 0.98em;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.18s;
            text-decoration: none;
        }
        .icon-btn .material-icons {
            margin-bottom: 2px;
            font-size: 28px;
            line-height: 28px;
        }
        .icon-btn span {
            font-size: 0.93em;
            margin-top: 1px;
        }
        .icon-btn:hover {
            color: #fff;
        }
        @media (max-width: 700px) {
            .bottom-panel { font-size: 0.93em; }
        }
        body { padding-bottom: 60px !important; }
        @media (max-width: 480px) {
            .main-content {
                padding: 12px 2px 80px 2px;
            }
            .glass-card {
                padding: 18px 6px 12px 6px;
            }
            .manual-input {
                padding: 10px 2px 8px 2px;
            }
            .header, .glass-card h2, .scan-result .result-text, .manual-input h3 {
                font-size: 1em;
            }
            .upload-text, .upload-subtext, .scan-result, .example-ticket, .input-group input {
                font-size: 0.95em;
            }
            .btn {
                margin-bottom: 10px;
            }
            .btn:last-child {
                margin-bottom: 0;
            }
            .input-group {
                flex-direction: column;
                gap: 6px;
            }
            #video {
                width: 100vw;
                max-width: 100vw;
                border-radius: 10px;
            }
            #video-container {
                max-width: 100vw;
            }
            .icon-btn span {
                font-size: 0.85em;
            }
            .icon-btn .material-icons {
                font-size: 22px;
            }
        }
        html, body {
            overflow-x: hidden;
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="header has-back">
        <button class="back-btn" onclick="goBack()" title="Back">←</button>
        <span id="header-title">Ticket Scanner</span>
        <button class="lang-icon-btn" id="langIconBtn" title="Change language">🌐</button>
        <div class="lang-popup" id="langPopup">
            <div class="lang-popup-title">Select Language</div>
            <button class="lang-popup-btn" data-lang="en">English</button>
            <button class="lang-popup-btn" data-lang="ml">മലയാളം</button>
            <button class="lang-popup-btn" data-lang="ta">தமிழ்</button>
        </div>
    </div>
    <div class="main-content">
        <div class="glass-card">
            <h2>📷 Scan Your Lottery Ticket</h2>
            <p style="text-align: center; color: #666; margin-bottom: 25px; font-size: 1.1em;">
                Upload a photo of your ticket or use camera to scan
            </p>
            <!-- File Upload Area -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">📷</div>
                <div class="upload-text">Drop your ticket image here or click to browse</div>
                <div class="upload-subtext">Supports JPG, PNG, PDF files</div>
                <input type="file" id="fileInput" accept="image/*,.pdf" style="display: none;">
            </div>
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn" onclick="document.getElementById('fileInput').click()">📁 Choose File</button>
                <button class="btn secondary" onclick="startCamera()">📹 Use Camera</button>
                <button class="btn secondary" onclick="clearScan()">Clear</button>
            </div>
            <!-- Camera Section -->
            <div class="camera-section" id="cameraSection" style="display: none;">
                <div id="video-container">
                    <video id="video" autoplay></video>
                    <div class="scan-overlay"></div>
                </div>
                <div>
                    <button class="btn success" onclick="stopCamera()">Stop Camera</button>
                </div>
                <canvas id="canvas" style="display: none;"></canvas>
            </div>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Scanning ticket and extracting information...</p>
            </div>
            <div id="scanResult"></div>
            <!-- Manual Input Section -->
            <div class="manual-input" style="width:100%;margin-top:24px;background:rgba(255,255,255,0.55);border:1.5px solid #e0e7ff;">
                <h3>✏️ Manual Entry</h3>
                <p style="color: #666; margin-bottom: 15px;">Or enter ticket details manually:</p>
                <div class="input-group">
                    <input type="text" id="ticketNumber" placeholder="Ticket Number (e.g., MW 501046)">
                    <input type="text" id="lotteryType" placeholder="Lottery Type (e.g., SS, SM, BT)">
                </div>
                <div class="input-group">
                    <input type="text" id="drawNumber" placeholder="Draw Number">
                    <input type="date" id="drawDate" placeholder="Draw Date">
                </div>
                <div style="text-align: center;">
                    <button class="btn success" onclick="processManualInput()">🔍 Check Result</button>
                </div>
            </div>
            <!-- Ticket Preview -->
            <div class="ticket-preview" id="ticketPreview">
                <div class="ticket-header">
                    <h3>�� Ticket Information</h3>
                </div>
                <div class="ticket-details" id="ticketDetails">
                    <!-- Ticket details will be populated here -->
                </div>
            </div>
        </div>
        <div class="glass-card" style="margin-bottom:0;">
            <h2 style="font-size:1.13em;">💡 Example Tickets</h2>
            <p style="text-align: center; color: #666; margin-bottom: 18px; font-size: 1.08em;">
                Try scanning these example tickets to see how it works
            </p>
            <div class="example-numbers" style="width:100%;display:flex;flex-wrap:wrap;gap:10px;justify-content:center;">
                <div class="example-number" onclick="loadExampleTicket('MW 501046', 'SS', '10', '2025-07-06')">MW 501046 (1st Prize)</div>
                <div class="example-number" onclick="loadExampleTicket('MR 594475', 'SS', '10', '2025-07-06')">MR 594475 (2nd Prize)</div>
                <div class="example-number" onclick="loadExampleTicket('0875', 'SS', '10', '2025-07-06')">0875 (4th Prize)</div>
                <div class="example-number" onclick="loadExampleTicket('999999', 'SS', '10', '2025-07-06')">999999 (No Win)</div>
            </div>
        </div>
    </div>
    <nav class="bottom-panel">
        <a class="icon-btn" href="index.html">
            <span class="material-icons">home</span>
            <span>Home</span>
        </a>
        <a class="icon-btn" href="prediction.html">
            <span class="material-icons">star</span>
            <span>Lucky</span>
        </a>
        <a class="icon-btn" href="search.html">
            <span class="material-icons">search</span>
            <span>Search</span>
        </a>
        <a class="icon-btn" href="scanner.html">
            <span class="material-icons">qr_code_scanner</span>
            <span>Scanner</span>
        </a>
    </nav>
    <script src="https://unpkg.com/@zxing/browser@0.1.1/umd/index.min.js"></script>
    <script>
        let stream = null;
        let historyData = [];
        // Load real data
        fetch('history.json')
          .then(res => res.json())
          .then(data => { historyData = data; })
          .catch(() => { historyData = []; });

        document.addEventListener('DOMContentLoaded', function() {
            setupFileUpload();
            setLang(currentLang);
            updateHeaderTitle();
        });

        function setupFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    processFile(files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    processFile(e.target.files[0]);
                }
            });
        }

        function processFile(file) {
            const loading = document.getElementById('loading');
            const scanResult = document.getElementById('scanResult');
            
            loading.style.display = 'block';
            scanResult.innerHTML = '';
            
            // Simulate file processing
            setTimeout(() => {
                loading.style.display = 'none';
                
                // Simulate OCR result (in real app, this would use actual OCR)
                const mockResult = simulateOCR(file.name);
                displayScanResult(mockResult);
                
            }, 2000);
        }

        function simulateOCR(filename) {
            // Simulate different OCR results based on filename
            const examples = [
                { number: 'MW 501046', type: 'SS', draw: '10', date: '2025-07-06', status: 'winner', prize: '1st Prize - ₹1,00,00,000' },
                { number: 'MR 594475', type: 'SS', draw: '10', date: '2025-07-06', status: 'winner', prize: '2nd Prize - ₹30,00,000' },
                { number: '0875', type: 'SS', draw: '10', date: '2025-07-06', status: 'winner', prize: '4th Prize - ₹5,000' },
                { number: '999999', type: 'SS', draw: '10', date: '2025-07-06', status: 'no-win', prize: 'No Win' }
            ];
            
            return examples[Math.floor(Math.random() * examples.length)];
        }

        // ZXing barcode/QR scanner logic
        let codeReader = null;
        let scanActive = false;
        async function startCamera() {
            if (scanActive) return;
            scanActive = true;
            const video = document.getElementById('video');
            document.getElementById('cameraSection').style.display = 'block';
            if (!codeReader) {
                codeReader = new ZXingBrowser.BrowserMultiFormatReader();
            }
            codeReader.decodeFromVideoDevice(null, video, (result, err, controls) => {
                if (result) {
                    stopCamera();
                    handleScanResult(result.getText());
                }
            });
        }
        function stopCamera() {
            scanActive = false;
            if (codeReader) codeReader.reset();
            document.getElementById('cameraSection').style.display = 'none';
        }
        function handleScanResult(text) {
            // Try to extract ticket number and date from QR/barcode text
            // Example: "MW 501046|2025-07-06" or just the number
            let ticketNumber = '', drawDate = '';
            if (text.includes('|')) {
                [ticketNumber, drawDate] = text.split('|');
            } else {
                ticketNumber = text;
            }
            document.getElementById('ticketNumber').value = ticketNumber.trim();
            if (drawDate) document.getElementById('drawDate').value = drawDate.trim();
            // Optionally, auto-search if both fields are filled
            if (ticketNumber && drawDate) {
                processManualInput();
            }
        }
        function processManualInput() {
            const number = document.getElementById('ticketNumber').value.trim();
            const date = document.getElementById('drawDate').value;
            if (!number || !date) {
                alert('Please fill in ticket number and date');
                return;
            }
            // Search in history.json
            const formattedDate = date.includes('-') ? date.split('-').reverse().join('/') : date;
            const result = historyData.find(r => r.date === formattedDate || r.date === date);
            let found = null;
            if (result) {
                const searchLower = number.replace(/\s+/g, '').toLowerCase();
                (result.numbers4 || []).forEach(num => {
                    if (num.replace(/\s+/g, '').toLowerCase() === searchLower) {
                        found = { number: num, type: '4-digit', date: result.date, status: 'winner', prize: '4-digit Prize' };
                    }
                });
                (result.numbers6 || []).forEach(num => {
                    if (num.replace(/\s+/g, '').toLowerCase() === searchLower) {
                        found = { number: num, type: '6-digit', date: result.date, status: 'winner', prize: '6-digit Prize' };
                    }
                });
            }
            if (found) {
                displayScanResult(found);
            } else {
                displayScanResult({ number, date, status: 'no-win', prize: 'No Win' });
            }
        }
        function displayScanResult(result) {
            const scanResult = document.getElementById('scanResult');
            const ticketPreview = document.getElementById('ticketPreview');
            const ticketDetails = document.getElementById('ticketDetails');
            let resultClass = 'info';
            let resultIcon = '📋';
            let resultText = 'Ticket scanned successfully';
            if (result.status === 'winner') {
                resultClass = 'success';
                resultIcon = '🎉';
                resultText = 'CONGRATULATIONS! You are a WINNER!';
            } else if (result.status === 'no-win') {
                resultClass = 'error';
                resultIcon = '😔';
                resultText = 'Sorry, this ticket did not win';
            }
            scanResult.innerHTML = `
                <div class="scan-result ${resultClass}">
                    <span class="result-icon">${resultIcon}</span>
                    <span class="result-text">${resultText}</span><br>
                    <strong>Prize:</strong> ${result.prize}
                    <div style="margin-top:12px;text-align:center;">
                        <a href="note/${getResultPageFilename(result.date)}" target="_blank" class="btn" style="background:linear-gradient(135deg,#7ecbff 0%,#2563eb 100%);color:#fff;font-weight:700;font-size:1.08em;padding:10px 22px;border-radius:12px;box-shadow:0 2px 8px #2563eb22;display:inline-block;">View Full Result Page</a>
                    </div>
                </div>
            `;
            // Update ticket preview
            ticketDetails.innerHTML = `
                <div class="detail-item">
                    <span class="detail-label">Ticket Number:</span>
                    <span class="detail-value">${result.number}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Draw Date:</span>
                    <span class="detail-value">${formatDate(result.date)}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value">${result.status === 'winner' ? '🎉 WINNER' : '😔 No Win'}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Prize:</span>
                    <span class="detail-value">${result.prize}</span>
                </div>
            `;
            ticketPreview.classList.add('show');
        }
        function getResultPageFilename(dateStr) {
            if (!dateStr) return '';
            const [dd, mm, yyyy] = dateStr.split('/');
            return `${yyyy}-${mm}-${dd}.html`;
        }

        function loadExampleTicket(number, type, draw, date) {
            document.getElementById('ticketNumber').value = number;
            document.getElementById('lotteryType').value = type;
            document.getElementById('drawNumber').value = draw;
            document.getElementById('drawDate').value = date;
            
            const result = checkTicketResult(number, type, date);
            displayScanResult(result);
        }

        function clearScan() {
            document.getElementById('scanResult').innerHTML = '';
            document.getElementById('ticketPreview').classList.remove('show');
            document.getElementById('fileInput').value = '';
            stopCamera();
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN');
        }

        // Language logic (same as index.html/prediction.html)
        const langIconBtn = document.getElementById('langIconBtn');
        const langPopup = document.getElementById('langPopup');
        const langPopupBtns = langPopup.querySelectorAll('.lang-popup-btn');
        let currentLang = localStorage.getItem('lang') || 'en';
        function setLang(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            updateHeaderTitle();
            langPopupBtns.forEach(btn => btn.classList.toggle('active', btn.getAttribute('data-lang') === lang));
        }
        function updateHeaderTitle() {
            const w = window.innerWidth;
            if (w < 400) {
                document.getElementById('header-title').textContent = langStringsShort[currentLang] || langStringsShort['en'];
            } else {
                document.getElementById('header-title').textContent = langStrings[currentLang] || langStrings['en'];
            }
        }
        window.addEventListener('resize', updateHeaderTitle);
        langIconBtn.addEventListener('click', function() {
            langPopup.classList.toggle('active');
        });
        document.body.addEventListener('click', function(e) {
            if (!langPopup.contains(e.target) && e.target !== langIconBtn) {
                langPopup.classList.remove('active');
            }
        });
        langPopupBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                setLang(this.getAttribute('data-lang'));
                langPopup.classList.remove('active');
            });
        });
        // Language strings
        const langStrings = {
            en: 'Ticket Scanner',
            ml: 'ടിക്കറ്റ് സ്കാനർ',
            ta: 'டிக்கெட் ஸ்கேனர்'
        };
        // Short language strings for mobile
        const langStringsShort = {
            en: 'Scanner',
            ml: 'സ്കാനർ',
            ta: 'ஸ்கேனர்'
        };
        document.addEventListener('DOMContentLoaded', function() {
            setLang(currentLang);
            updateHeaderTitle();
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.getElementById('nav-scan').classList.add('active');
        });
        function goBack() {
            window.history.length > 1 ? window.history.back() : window.location.href = 'index.html';
        }
    </script>
</body>
</html> 
